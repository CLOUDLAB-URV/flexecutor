from flexecutor.modelling.perfmodel import PerfModel

if __name__ == "__main__":
    profiling_results = {
        (1, 1024, 4): {
            "read": [
                [
                    0.13607573509216309,
                    0.11152410507202148,
                    0.12084269523620605,
                ],
                [
                    0.12205648422241211,
                    0.0889730453491211,
                    0.09708809852600098,
                ],
                [
                    0.12345600128173828,
                    0.09127664566040039,
                    0.09938955307006836,
                ],
            ],
            "write": [
                [
                    0.21655988693237305,
                    0.313230037689209,
                    0.37512636184692383,
                ],
                [
                    0.2964909076690674,
                    0.32325196266174316,
                    0.2654855251312256,
                ],
                [
                    0.29856061935424805,
                    0.325498104095459,
                    0.2687644958496094,
                ],
            ],
            "compute": [
                [
                    0.6712195873260498,
                    0.6449689865112305,
                    0.6611623764038086,
                ],
                [
                    0.663583517074585,
                    0.649554967880249,
                    0.6580414772033691,
                ],
                [
                    0.6651899814605713,
                    0.6512856483459473,
                    0.6599874496459961,
                ],
            ],
            "cold_start": [
                [
                    2.6361682415008545,
                    2.7001962661743164,
                    2.8119142055511475,
                ],
                [
                    2.5462496280670166,
                    2.6483700275421143,
                    2.767951011657715,
                ],
                [
                    2.5534894466400146,
                    2.654780626296997,
                    2.771085500717163,
                ],
            ],
        },
        (2, 2048, 8): {
            "read": [
                [
                    0.13807916641235352,
                    0.11352825164794922,
                    0.12284612655639648,
                ],
                [
                    0.12406063079833984,
                    0.09097719192504883,
                    0.09909176826477051,
                ],
                [
                    0.12546062469482422,
                    0.09328079223632812,
                    0.10139322280883789,
                ]
            ],
            "write": [
                [
                    0.21856307983398438,
                    0.3152332305908203,
                    0.37712836265563965,
                ],
                [
                    0.2984933853149414,
                    0.3252544403076172,
                    0.2674875259399414,
                ],
                [
                    0.30056309700012207,
                    0.327500581741333,
                    0.2707664966583252,
                ],                
            ],
            "compute": [
                [
                    0.6732230186462402,
                    0.6470727920532227,
                    0.663165807723999,
                ],
                [
                    0.6655876636505127,
                    0.651658296585083,
                    0.6600449085235596,
                ],
                [
                    0.6671931743621826,
                    0.6533889770507812,
                    0.6619914779663086,
                ],
            ],
            "cold_start": [
                [
                    2.638171672821045,
                    2.702199697494507,
                    2.8139162063598633,
                ],
                [
                    2.548252582550049,
                    2.6503734588623047,
                    2.7699530124664307,
                ],
                [
                    2.555492401123047,
                    2.6567840576171875,
                    2.773087978363037,
                ],
            ],
        },
        (3, 3072, 16): {
            "read": [
                [
                    0.14008259773254395,
                    0.11553239822387695,
                    0.12484955787658691,
                ],
                [
                    0.12606406211853027,
                    0.09298133850097656,
                    0.10109519958496094,
                ],
                [
                    0.12746405601501465,
                    0.09528493881225586,
                    0.10339665412902832,
                ]
            ],
            "write": [
                [
                    0.2205662727355957,
                    0.31723642349243164,
                    0.37913036346435547,
                ],
                [
                    0.30049657821655273,
                    0.3272576332092285,
                    0.2694895267486572,
                ],
                [
                    0.3025662899017334,
                    0.32950377464294434,
                    0.272768497467041,
                ],
            ],
            "compute": [
                [
                    0.6752264499664307,
                    0.6491765975952148,
                    0.6651692390441895,
                ],
                [
                    0.667590856552124,
                    0.653761625289917,
                    0.66204833984375,
                ],
                [
                    0.669196367263794,
                    0.6554923057556152,
                    0.6639947891235352,
                ],
            ],
            "cold_start": [
                [
                    2.6401751041412354,
                    2.7042031288146973,
                    2.815918207168579,
                ],
                [
                    2.55025577545166,
                    2.652376651763916,
                    2.7719550132751465,
                ],
                [
                    2.557495594024658,
                    2.658787250518799,
                    2.775089979171753,
                ],
            ],
        },

    }


    perfmodel = PerfModel.instance("stage")
    perfmodel.update_allow_parallel(True)
    perfmodel.train(profiling_results)
    res = perfmodel.predict(1, 1024, 4, mode='latency')
    print(res)
from flexecutor.modelling.perfmodel import PerfModel

if __name__ == "__main__":
    profiling_data = {
        (2, 400, 5): {
            "read": [
                [
                    0.13607573509216309,
                    0.11152410507202148,
                    0.12084269523620605,
                    0.12781190872192383,
                    0.10123634338378906,
                ],
                [
                    0.12205648422241211,
                    0.0889730453491211,
                    0.09708809852600098,
                    0.09705781936645508,
                    0.08011627197265625,
                ],
            ],
            "write": [
                [
                    0.21655988693237305,
                    0.313230037689209,
                    0.37512636184692383,
                    0.44702625274658203,
                    0.3391242027282715,
                ],
                [
                    0.2964909076690674,
                    0.32325196266174316,
                    0.2654855251312256,
                    0.24427175521850586,
                    0.2672877311706543,
                ],
            ],
            "compute": [
                [
                    0.6712195873260498,
                    0.6449689865112305,
                    0.6611623764038086,
                    0.680020809173584,
                    0.7658612728118896,
                ],
                [
                    0.663583517074585,
                    0.649554967880249,
                    0.6580414772033691,
                    0.6754159927368164,
                    0.7627818584442139,
                ],
            ],
            "cold_start_time": [
                [
                    2.6361682415008545,
                    2.7001962661743164,
                    2.8119142055511475,
                    2.8189210891723633,
                    3.142885684967041,
                ],
                [
                    2.5462496280670166,
                    2.6483700275421143,
                    2.767951011657715,
                    2.821345567703247,
                    2.9759883880615234,
                ],
            ],
        }
    }

    model = PerfModel.instance("genetic")
    model.train(profiling_data)
    model.save_model()
    print("Objective Function:", model.objective_func)
    prediction = model.predict(2, 400, 5)
    print("Predicted Latency for (2 CPUs, 400 Memory, 5 Workers):", prediction.total_time)
